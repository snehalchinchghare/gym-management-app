<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<div *ngIf="errorMessage" class="alert alert-warning">
  {{ errorMessage }}
</div>

<div class="container d-flex justify-content-center align-items-center py-5"
  style="min-height: 100vh; font-family: 'Poppins', sans-serif;">
  <div class="card border-0 shadow-lg rounded-5 p-4 w-100" style="max-width: 600px; background-color: #fefefe;">
    <h3 class="text-center mb-4 text-success fw-semibold">Admin Registration</h3>

    <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <div class="row g-3">

        <!-- Name -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Full Name</label>
          <input type="text" class="form-control rounded-pill px-4 py-2" formControlName="fullName"
            placeholder="Full Name" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('fullName')?.touched &&
            registerForm.get('fullName')?.invalid
          ">
            Full Name is required.
          </div>
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Email</label>
          <input type="email" class="form-control rounded-pill px-4 py-2" formControlName="email"
            placeholder="admin@gmail.com" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('email')?.touched &&
            registerForm.get('email')?.invalid
          ">
            Valid email is required.
          </div>

        </div>

        <!-- Enter OTP + Get OTP/Verify Button (Same row) -->
        <div class="mb-3">
          <div class="form-check mb-2">
            <input type="checkbox" class="form-check-input" [checked]="manuallyEnterOtp" id="alreadyHaveOtp" [(ngModel)]="manuallyEnterOtp" (change)="onToggleManualOtp()" />
            <label class="form-check-label" for="alreadyHaveOtp">I already have an OTP</label>
          </div>
          <div class="input-group">
            <input type="text" class="form-control px-4 py-2 border-end-0" formControlName="emailOtp"
              placeholder="Enter OTP" style="border-top-left-radius: 50rem; border-bottom-left-radius: 50rem;" />
            <button *ngIf="!otpSent" type="button" class="btn btn-success px-3 py-2" (click)="sendOtp()"
              style="border-top-right-radius: 50rem; border-bottom-right-radius: 50rem;">
              Get OTP
            </button>
            <button *ngIf="otpSent" type="button" class="btn btn-success px-3 py-2" (click)="validateOtp()"
              style="border-top-right-radius: 50rem; border-bottom-right-radius: 50rem;">
              Verify
            </button>
          </div>
          
          <!-- Success message -->
          <div class="text-success small mt-1 ms-1" *ngIf="!manuallyEnterOtp && otpSent && !otpValidated">
            OTP has been sent to your email.
          </div>
          <!-- Success message -->
          <div class="text-success small mt-1 ms-1" *ngIf="otpValidated">
            OTP validation successful.
          </div>
        </div>


        <!-- Mobile -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Mobile</label>
          <input type="number" class="form-control rounded-pill px-4 py-2" formControlName="gymmobile"
            placeholder="mobile" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('gymmobile')?.touched &&
            registerForm.get('gymmobile')?.invalid
          ">
            Valid mobile number is required.
          </div>
        </div>

        <!-- Gym Name -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Gym Name</label>
          <input type="text" class="form-control rounded-pill px-4 py-2" formControlName="gymName"
            placeholder="Gym Name" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('gymName')?.touched &&
            registerForm.get('gymName')?.invalid
          ">
            Gym Name is required.
          </div>
        </div>

        <!-- Gym Address -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Gym Address</label>
          <input type="text" class="form-control rounded-pill px-4 py-2" formControlName="gymAddress"
            placeholder="Gym Address" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('gymAddress')?.touched &&
            registerForm.get('gymAddress')?.invalid
          ">
            Gym Address is required.
          </div>
        </div>

        <!-- Gym Logo -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Gym Logo</label>
          <input type="file" class="form-control rounded-pill px-4 py-2" accept="image/*"
            (change)="onFileSelected($event)" formControlName="gymLogo" placeholder="Gym Logo" />
          <div class="text-danger small mt-1" *ngIf="
            registerForm.get('gymLogo')?.touched &&
            registerForm.get('gymLogo')?.invalid && 
            fileError
          ">
            Gym Logo is required (image formats only)
          </div>
        </div>

        <!-- Membership Details -->
        <div class="accordion mb-3">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button fw-semibold form-label text-muted ms-2"
                [class.collapsed]="!isMembershipTableCollapsed" type="button" (click)="togglemembershipTable()">
                Membership Pricing
              </button>
            </h2>

            <div class="accordion-collapse" [class.collapse]="true" [class.show]="isMembershipTableCollapsed">
              <div class="accordion-body p-2">
                <div style="overflow-x: auto; width: 100%;">
                  <table class="table table-bordered text-center align-middle small" style="min-width: 700px;">
                    <thead class="table-primary">
                      <tr>
                        <th class="form-label fw-semibold text-muted ms-2">Duration</th>
                        <th class="form-label fw-semibold text-muted ms-2">Gym</th>
                        <th class="form-label fw-semibold text-muted ms-2">Gym + Cardio</th>
                        <th class="form-label fw-semibold text-muted ms-2">Cardio</th>
                        <th class="form-label fw-semibold text-muted ms-2">Personal Trainer</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="form-label fw-semibold text-muted ms-2">
                        <td>Monthly</td>
                        <td>
                          <input type="text" class="form-control" formControlName="gym_monthly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="gymCardio_monthly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="cardio_monthly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="pt_monthly" />
                        </td>
                      </tr>
                      <tr class="form-label fw-semibold text-muted ms-2">
                        <td>Quarterly</td>
                        <td>
                          <input type="text" class="form-control" formControlName="gym_quarterly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="gymCardio_quarterly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="cardio_quarterly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="pt_quarterly" />
                        </td>
                      </tr>
                      <tr class="form-label fw-semibold text-muted ms-2">
                        <td>Half Yearly</td>
                        <td>
                          <input type="text" class="form-control" formControlName="gym_halfYearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="gymCardio_halfYearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="cardio_halfYearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="pt_halfYearly" />
                        </td>
                      </tr>
                      <tr class="form-label fw-semibold text-muted ms-2">
                        <td>Yearly</td>
                        <td>
                          <input type="text" class="form-control" formControlName="gym_yearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="gymCardio_yearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="cardio_yearly" />
                        </td>
                        <td>
                          <input type="text" class="form-control" formControlName="pt_yearly" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Password -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Password</label>
          <input type="password" class="form-control rounded-pill px-4 py-2" formControlName="password"
            placeholder="******" (input)="onPasswordInput()" />
          <div class="text-danger small mt-1"
            *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.invalid">
            Password is required.
          </div>

          <!-- Password rules checklist -->
          <div class="password-hint-box mt-2 px-3 py-2 rounded">
            <div class="small fw-semibold mb-2">Password must contain:</div>
            <ul class="list-unstyled mb-0 small">
              <li [class.text-success]="passwordRules.length" [class.text-danger]="!passwordRules.length">
                <i class="bi me-1" [ngClass]="passwordRules.length ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                Minimum 8 characters
              </li>
              <li [class.text-success]="passwordRules.uppercase" [class.text-danger]="!passwordRules.uppercase">
                <i class="bi me-1"
                  [ngClass]="passwordRules.uppercase ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                At least 1 uppercase letter
              </li>
              <li [class.text-success]="passwordRules.lowercase" [class.text-danger]="!passwordRules.lowercase">
                <i class="bi me-1"
                  [ngClass]="passwordRules.lowercase ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                At least 1 lowercase letter
              </li>
              <li [class.text-success]="passwordRules.number" [class.text-danger]="!passwordRules.number">
                <i class="bi me-1" [ngClass]="passwordRules.number ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                At least 1 number
              </li>
              <li [class.text-success]="passwordRules.special" [class.text-danger]="!passwordRules.special">
                <i class="bi me-1" [ngClass]="passwordRules.special ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                At least 1 special character
              </li>
            </ul>
          </div>
        </div>

        <!-- Confirm Password -->
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted ms-2">Confirm Password</label>
          <input type="password" class="form-control rounded-pill px-4 py-2" formControlName="confirmPassword"
            placeholder="******" />
          <div class="text-danger small" *ngIf="
            registerForm.get('confirmPassword')?.touched &&
            registerForm.get('confirmPassword')?.invalid
          ">
            Please confirm your password.
          </div>
        </div>

        <button class="btn btn-success rounded-pill w-100 py-2" [disabled]="registerForm.invalid">
          Register
        </button>

      </div>
    </form>

    <div class="text-center mt-3">
      <a routerLink="/login" class="text-decoration-none">Already Registered? Login</a>
    </div>
  </div>
</div>

<!-- ✅ Toast Notification -->
<div id="registerToast" class="toast align-items-center text-white border-0 position-fixed bottom-0 end-0 m-4 bg-danger"
  role="alert" aria-live="assertive" aria-atomic="true" style="z-index: 9999">
  <div class="d-flex">
    <div class="toast-body">
      <!-- Toast message will be injected dynamically -->
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
      aria-label="Close"></button>
  </div>
</div>